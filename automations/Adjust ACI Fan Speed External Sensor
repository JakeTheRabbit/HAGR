alias: '1.5 Adjust Fan Speed Based on Temperature'
description: 'Adjusts fan speed based on temperature and time of day'
trigger:
  - platform: state
    entity_id: sensor.esppoe_3_scd_41_poe3_temperature
  - platform: time_pattern
    minutes: "/5"  # Adjusts every 5 minutes
  - platform: state
    entity_id: input_number.1_5_day_temperature_target
  - platform: state
    entity_id: input_number.1_5_night_temperature_target
condition: []
action:
  - choose:
      - conditions:
          - condition: time
            after: input_datetime.1_5_lights_on_time
            before: input_datetime.1_5_lights_off_time
        sequence:
          - service: script.adjust_fan_speed
            data:
              current_temp_entity: sensor.esppoe_3_scd_41_poe3_temperature
              target_temp_entity: input_number.1_5_day_temperature_target
              fan_speed_entity: number.1_5_port_1_on_speed
      - conditions:
          - condition: or
            conditions:
              - condition: time
                before: input_datetime.1_5_lights_on_time
              - condition: time
                after: input_datetime.1_5_lights_off_time
        sequence:
          - service: script.adjust_fan_speed
            data:
              current_temp_entity: sensor.esppoe_3_scd_41_poe3_temperature
              target_temp_entity: input_number.1_5_night_temperature_target
              fan_speed_entity: number.1_5_port_1_on_speed
mode: single
